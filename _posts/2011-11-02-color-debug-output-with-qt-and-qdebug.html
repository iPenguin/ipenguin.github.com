---
title: "Color debug output with Qt and qDebug()"
layout: "post"
permalink: "/2011/11/color-debug-output-with-qt-and-qdebug.html"
uuid: "96765458961442037"
guid: "tag:blogger.com,1999:blog-3270817893928434685.post-96765458961442037"
date: "2011-11-02 19:14:00"
updated: "2011-11-02 19:16:29"
description: 
blogger:
    siteid: "3270817893928434685"
    postid: "96765458961442037"
    comments: "0"
categories: [output, debug, color, qt]
author: 
    name: "Brian C. Milco"
    url: "http://www.blogger.com/profile/05356031750889872461?rel=author"
    image: "http://img2.blogblog.com/img/b16-rounded.gif"
comments: true
---

{% raw %}
<div class="css-full-post-content js-full-post-content">
I'm a very visual person, and color makes it a lot faster and easier for me to work. That's why I really like <a href="http://kdevelop.org/">kDevelop</a> with it's semantic highlighting. Anymore when I see grey text on a black console it feels blob-like and hard to read especially if the output is&nbsp;verbose.<br /><br />I use Qt on a regular basis for my day job and while I love the framework it's debug output is vanilla.&nbsp;So I wanted to go from:<br /><br /><pre>debug output<br />warning output<br />critical output<br />fatal output<br /></pre><br />to something a little more useful for finding problems:<br /><br /><pre><span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : debug output <br /><span class="Apple-style-span" style="color: #f1c232;">Warning</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : warning output <br /><span class="Apple-style-span" style="color: #cc0000;">Critical</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : critical output <br /><span class="Apple-style-span" style="color: #cc0000;">Fatal</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : fatal output<br /></pre><br /><br />Before we get started there are 2 main draw backs to this setup. First is that you can really only pass in QStrings. If you want to pass in anything else you have to wrap it like this: <pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></pre><pre>DEBUG("myNumber = " + QString::number(myNumber));<br /></pre><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></pre>Second and more important kDevelop and QtCreator don't display the colorized output properly, and it actually makes it harder to read debug information. Keeping that in mind let's continue. <br /><br />With a little customization to Qt's message handler you can get a description and a little color:<br /><br />errorhandler.h: <br /><pre><span style="color: navy;">#ifndef</span><span style="color: silver;"> </span>ERRORHANDLER_H</pre><pre><span style="color: navy;">#define</span><span style="color: silver;"> </span>ERRORHANDLER_H</pre><pre></pre><pre><span style="color: olive;">void</span><span style="color: silver;"> </span>errorHandler(QtMsgType<span style="color: silver;"> </span>type,<span style="color: silver;"> </span><span style="color: olive;">const</span><span style="color: silver;"> </span><span style="color: olive;">char</span><span style="color: silver;"> </span>*msg)</pre><pre>{</pre><pre><span style="color: silver;">    </span><span style="color: olive;">switch</span><span style="color: silver;"> </span>(type)<span style="color: silver;"> </span>{</pre><pre><span style="color: silver;">        </span><span style="color: olive;">case</span><span style="color: silver;"> </span>QtDebugMsg:</pre><pre><span style="color: silver;">            </span>fprintf(stderr,<span style="color: silver;"> </span><span style="color: green;">"%s\n"</span>,<span style="color: silver;"> </span>msg);</pre><pre><span style="color: silver;">            </span><span style="color: olive;">break</span>;</pre><pre><span style="color: silver;">        </span><span style="color: olive;">case</span><span style="color: silver;"> </span>QtWarningMsg:</pre><pre><span style="color: silver;">            </span>fprintf(stderr,<span style="color: silver;"> </span><span style="color: green;">"\033[1;33mWarning\033[0m:</span><span style="color: silver;"> </span><span style="color: green;">%s\n"</span>,<span style="color: silver;"> </span>msg);</pre><pre><span style="color: silver;">            </span><span style="color: olive;">break</span>;</pre><pre><span style="color: silver;">        </span><span style="color: olive;">case</span><span style="color: silver;"> </span>QtCriticalMsg:</pre><pre><span style="color: silver;">            </span>fprintf(stderr,<span style="color: silver;"> </span><span style="color: green;">"\033[31mCritical\033[0m:</span><span style="color: silver;"> </span><span style="color: green;">%s\n"</span>,<span style="color: silver;"> </span>msg);</pre><pre><span style="color: silver;">            </span><span style="color: olive;">break</span>;</pre><pre><span style="color: silver;">        </span><span style="color: olive;">case</span><span style="color: silver;"> </span>QtFatalMsg:</pre><pre><span style="color: silver;">            </span>fprintf(stderr,<span style="color: silver;"> </span><span style="color: green;">"\033[31mFatal\033[0m:</span><span style="color: silver;"> </span><span style="color: green;">%s\n"</span>,<span style="color: silver;"> </span>msg);</pre><pre><span style="color: silver;">            </span>abort();</pre><pre><span style="color: silver;">    </span>}</pre><pre>}</pre><pre></pre><pre><span style="color: navy;">#endif</span><span style="color: silver;"> </span><span style="color: green;">//</span><span style="color: silver;"> </span><span style="color: green;">ERRORHANDLER_H</span></pre><pre><span class="Apple-style-span" style="color: green;"><br /></span></pre><pre><span class="Apple-style-span" style="font-family: Times; white-space: normal;">main.cpp:</span></pre><pre><span style="color: navy;">#include</span> <span style="color: green;">"errorhandler.h"</span><br />...</pre><pre><span style="color: olive;">int</span> main(<span style="color: olive;">int</span> argc, <span style="color: olive;">char</span> *argv[])<br />{<br />    qInstallMsgHandler(errorHandler);<br />   &nbsp;<span class="Apple-style-span" style="color: purple;">QApplication</span> a(argc, argv);</pre><pre>    qDebug() &lt;&lt; <span style="color: green;">"debug output"</span>;<br />    qWarning() &lt;&lt; <span style="color: green;">"warning output"</span>;<br />    qCritical() &lt;&lt; <span style="color: green;">"critical output"</span>;<br />    qFatal(<span style="color: green;">"fatal output"</span>);<br />...<br />}<br /></pre><br /><pre><span class="Apple-style-span" style="font-family: Times; white-space: normal;">This will give you the following output:</span></pre><br /><pre>debug output <br /><span class="Apple-style-span" style="color: #f1c232;">Warning</span>: warning output <br /><span class="Apple-style-span" style="color: #cc0000;">Critical</span>: critical output <br /><span class="Apple-style-span" style="color: #cc0000;">Fatal</span>: fatal output<br /></pre><br /><pre><span class="Apple-style-span" style="font-family: Times; white-space: normal;">That's a nice start but I also like to include the function name in the debug output so I know which class and function is giving me which output, but I hate having to add the information manually. What I want is&nbsp;</span>__PRETTY_FUNCTION__<span class="Apple-style-span" style="font-family: Times; white-space: normal;">&nbsp;or&nbsp;</span>Q_FUNC_INFO <span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">(basically the same thing)</span><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif; white-space: normal;">,</span><span class="Apple-style-span" style="font-family: Times; white-space: normal;"> but if you include that in the error handler above it's going to give you&nbsp;</span>void errorHandler(QtMsgType, const char*)<span class="Apple-style-span" style="font-family: Times; white-space: normal;">. Not very useful. So I put together some macros to pass messages and data to the actual message handlers with the&nbsp;</span>Q_FUNC_INFO<span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"> prepended.</span></pre><br /><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">debug.h:</span></pre><pre><span style="color: navy;">#ifndef</span><span style="color: silver;"> </span>DEBUG_H<br /><span style="color: navy;">#define</span><span style="color: silver;"> </span>DEBUG_H<br /><br /><span style="color: navy;">#include</span><span style="color: silver;"> </span><span style="color: green;">&lt;QDebug&gt;</span><br /><br /><span style="color: navy;">#define</span><span style="color: silver;"> </span>DEBUG(message) \<br />( \<br />    (qDebug() &lt;&lt; <span style="color: purple;">Q_FUNC_INFO</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span><span style="color: green;">":"</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span>QString(message).toStdString().c_str()),<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(<span style="color: olive;">void</span>)<span style="color: navy;">0</span><span style="color: silver;"> </span>\</pre><pre>)</pre><br /><pre><span style="color: navy;">#define</span><span style="color: silver;"> </span>WARN(message)<span style="color: silver;"> </span>\</pre><pre>(<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(qWarning()<span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span><span class="Apple-style-span" style="color: purple;">Q_FUNC_INFO</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span><span style="color: green;">":"</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span>QString(message).toStdString().c_str()),<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(<span style="color: olive;">void</span>)<span style="color: navy;">0</span><span style="color: silver;"> </span>\</pre><pre>)</pre><br /><pre><span style="color: navy;">#define</span><span style="color: silver;"> </span>CRITICAL(message)<span style="color: silver;"> </span>\</pre><pre>(<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(qCritical()<span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span><span class="Apple-style-span" style="color: purple;">Q_FUNC_INFO</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span><span style="color: green;">":"</span><span style="color: silver;"> </span>&lt;&lt;<span style="color: silver;"> </span>QString(message).toStdString().c_str()),<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(<span style="color: olive;">void</span>)<span style="color: navy;">0</span><span style="color: silver;"> </span>\</pre><pre>)</pre><br /><pre><span style="color: navy;">#define</span><span style="color: silver;"> </span>FATAL(message)<span style="color: silver;"> </span>\</pre><pre>(<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(qFatal(<span style="color: green;">"%s</span><span style="color: silver;"> </span><span style="color: green;">:</span><span style="color: silver;"> </span><span style="color: green;">%s"</span>,<span style="color: silver;"> </span><span class="Apple-style-span" style="color: purple;">Q_FUNC_INFO</span>,<span style="color: silver;"> </span>QString(message).toStdString().c_str())),<span style="color: silver;"> </span>\</pre><pre><span style="color: silver;">    </span>(<span style="color: olive;">void</span>)<span style="color: navy;">0</span><span style="color: silver;"> </span>\</pre><pre>)</pre><pre></pre><pre><span style="color: navy;">#endif</span><span style="color: silver;"> </span><span style="color: green;">//</span><span style="color: silver;"> </span><span style="color: green;">DEBUG_H</span></pre><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">Because of the formatting in the macros you can use them in code as if they were actual functions. Changing the debug lines in </span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">main()</span><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"> above to the following:</span><br /><pre></pre><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></pre><pre>DEBUG("debug output");<br />WARN("warning output");<br />CRITICAL("critical output");<br />FATAL("fatal output");<br /></pre><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></pre><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">Results in the output:</span></pre><pre><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></pre><pre>MainWindow::MainWindow(QStringList, QWidget*) : debug output <br /><span class="Apple-style-span" style="color: #f1c232;">Warning</span>: MainWindow::MainWindow(QStringList, QWidget*) : warning output <br /><span class="Apple-style-span" style="color: #cc0000;">Critical</span>: MainWindow::MainWindow(QStringList, QWidget*) : critical output <br /><span class="Apple-style-span" style="color: #cc0000;">Fatal</span>: MainWindow::MainWindow(QStringList, QWidget*) : fatal output<br /></pre><div><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">Useful but still a lot of blob-like black text. So I decided to create a function to parse the&nbsp;</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">Q_FUNC_INFO</span><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">&nbsp;string and add a little more color. So I added this to the debug.cpp files.</span><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">debug.cpp:</span><br /><pre><span style="color: navy;">#include</span><span style="color: silver;"> </span><span style="color: green;">"debug.h"</span></pre><pre></pre><pre><span style="color: navy;">#include</span><span style="color: silver;"> </span><span style="color: green;">&lt;QStringList&gt;</span></pre><pre><span style="color: navy;">#include</span><span style="color: silver;"> </span><span style="color: green;">&lt;QString&gt;</span></pre><pre><span style="color: green;"><br /></span></pre><pre></pre><pre><span style="color: purple;">QString</span><span style="color: silver;"> </span>debugFunctionName(<span style="color: purple;">QString</span><span style="color: silver;"> </span>name)</pre><pre>{</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QString</span><span style="color: silver;"> </span>output;</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QStringList</span><span style="color: silver;"> </span>classParts<span style="color: silver;"> </span>=<span style="color: silver;"> </span>name.split(<span style="color: green;">"::"</span>);</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QStringList</span><span style="color: silver;"> </span>nameAndReturnType<span style="color: silver;"> </span>=<span style="color: silver;"> </span>classParts.first().split(<span style="color: green;">"</span><span style="color: silver;"> </span><span style="color: green;">"</span>);</pre><br /><pre><span style="color: silver;">    </span><span style="color: purple;">QString</span><span style="color: silver;"> </span>returnType<span style="color: silver;"> </span>=<span style="color: silver;"> </span><span style="color: green;">""</span>; <span class="Apple-style-span" style="color: #38761d;">//ctor, dtor don't have return types</span></pre><pre><span style="color: silver;">    </span><span style="color: olive;">if</span>(nameAndReturnType.count()<span style="color: silver;"> </span>&gt;<span style="color: silver;"> </span><span style="color: navy;">1</span>) </pre><pre><span style="color: silver;">        </span>returnType<span style="color: silver;"> </span>=<span style="color: silver;"> </span>nameAndReturnType.first()<span style="color: silver;"> </span>+<span style="color: silver;"> </span><span style="color: green;">"</span><span style="color: silver;"> </span><span style="color: green;">"</span>;</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QString</span><span style="color: silver;"> </span>className<span style="color: silver;"> </span>=<span style="color: silver;"> </span>nameAndReturnType.last();</pre><br /><pre><span style="color: silver;">    </span><span style="color: purple;">QStringList</span><span style="color: silver;"> </span>funcAndParamas<span style="color: silver;"> </span>=<span style="color: silver;"> </span>classParts.last().split(<span style="color: green;">"("</span>);</pre><pre><span style="color: silver;">    </span>funcAndParamas.last().chop(<span style="color: navy;">1</span>);</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QString</span><span style="color: silver;"> </span>functionName<span style="color: silver;"> </span>=<span style="color: silver;"> </span>funcAndParamas.first();</pre><pre><span style="color: silver;">    </span><span style="color: purple;">QStringList</span><span style="color: silver;"> </span>params<span style="color: silver;"> </span>=<span style="color: silver;"> </span>funcAndParamas.last().split(<span style="color: green;">","</span>);</pre><br /><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[036m"</span>);</pre><pre><span style="color: silver;">    </span>output.append(returnType);</pre><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[0m\033[32m"</span>);</pre><pre><span style="color: silver;">    </span>output.append(className);</pre><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[0m::"</span>);</pre><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[34m"</span>);</pre><pre><span style="color: silver;">    </span>output.append(functionName);</pre><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[0m("</span>);</pre><br /><pre><span style="color: silver;">    </span><span style="color: purple;">QStringList</span>::<span style="color: purple;">const_iterator</span><span style="color: silver;"> </span>param;</pre><pre><span style="color: silver;">    </span><span style="color: olive;">for</span><span style="color: silver;"> </span>(param<span style="color: silver;"> </span>=<span style="color: silver;"> </span>params.begin();<span style="color: silver;"> </span>param<span style="color: silver;"> </span>!=<span style="color: silver;"> </span>params.constEnd();<span style="color: silver;"> </span>++param)<span style="color: silver;"> </span>{</pre><pre><span style="color: silver;">        </span><span style="color: olive;">if</span>(param<span style="color: silver;"> </span>!=<span style="color: silver;"> </span>params.begin())<span style="color: silver;"> </span>{</pre><pre><span style="color: silver;">            </span>output.append(<span style="color: green;">"\033[0m,"</span>);</pre><pre><span style="color: silver;">        </span>}</pre><pre><span style="color: silver;">        </span>output.append(<span style="color: green;">"\033[036m"</span>);</pre><pre><span style="color: silver;">        </span>output.append((*param));</pre><pre><span style="color: silver;">    </span>}</pre><pre><span style="color: silver;">    </span>output.append(<span style="color: green;">"\033[0m)"</span>);</pre><pre><span style="color: silver;">    </span><span style="color: olive;">return</span><span style="color: silver;"> </span>output;</pre><pre></pre><pre>}</pre><pre></pre><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span><br /><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;">Then in the macros replace&nbsp;</span><span class="Apple-style-span" style="color: purple; font-family: monospace; white-space: pre;">Q_FUNC_INFO</span><span class="Apple-style-span" style="white-space: pre;"><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"> with </span></span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">debugFunctionName</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">(</span><span style="color: purple; font-family: monospace; white-space: pre;">Q_FUNC_INFO</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">).</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">toStdString</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">().</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">c_str</span><span class="Apple-style-span" style="font-family: monospace; white-space: pre;">()</span><span class="Apple-style-span" style="white-space: pre;"><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"> and the output will look like this:</span></span><br /><span class="Apple-style-span" style="white-space: pre;"><span class="Apple-style-span" style="font-family: Times, 'Times New Roman', serif;"><br /></span></span><br /><pre><span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : debug output <br /><span class="Apple-style-span" style="color: #f1c232;">Warning</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : warning output <br /><span class="Apple-style-span" style="color: #cc0000;">Critical</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : critical output <br /><span class="Apple-style-span" style="color: #cc0000;">Fatal</span>: <span style="color: green;">MainWindow</span>::<span style="color: #0000aa;">MainWindow</span>(<span class="Apple-style-span" style="color: #6fa8dc;">QStringList</span>, <span class="Apple-style-span" style="color: #6fa8dc;">QWidget*</span>) : fatal output<br /></pre><br /></div>
</div>
{% endraw %}
